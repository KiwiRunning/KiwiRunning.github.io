(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d430b65c"],{"482a":function(t,a,e){"use strict";var s=e("e8cd"),i=e.n(s);i.a},5371:function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement;t._self._c;return t._m(0)},i=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("body",{staticClass:"typora-export"},[e("div",{staticClass:"is-mac",attrs:{id:"write"}},[e("h1",[e("a",{staticClass:"md-header-anchor",attrs:{name:"mysql"}}),e("span",[t._v("MySQL")])]),e("p",[e("span",[t._v("2019.12.06")])]),e("p",[e("a",{attrs:{href:"https://github.com/Snailclimb/JavaGuide"}},[e("span",[t._v("摘录自Github: Snailclimb/JavaGuide")])])]),e("p",[t._v(" ")]),e("p",[t._v(" ")]),e("h3",[e("a",{staticClass:"md-header-anchor",attrs:{name:"1查看mysql提供的所有存储引擎"}}),e("span",[t._v("1.查看MySQL提供的所有存储引擎")])]),e("p",[e("code",[t._v("mysql> show engines;")])]),e("p",[t._v(" ")]),e("h3",[e("a",{staticClass:"md-header-anchor",attrs:{name:"2myisam和innodb区别"}}),e("span",[t._v("2.MyISAM和InnoDB区别")])]),e("ul",[e("li",[e("strong",[e("span",[t._v("是否支持行级锁")])]),e("span",[t._v(" : MyISAM 只有表级锁(table-level locking)，而InnoDB 支持行级锁(row-level locking)和表级锁,默认为行级锁。")])]),e("li",[e("strong",[e("span",[t._v("是否支持事务和崩溃后的安全恢复： MyISAM")])]),e("span",[t._v(" 强调的是性能，每次查询具有原子性,其执行速度比InnoDB类型更快，但是不提供事务支持。但是")]),e("strong",[e("span",[t._v("InnoDB")])]),e("span",[t._v(" 提供事务支持事务，外部键等高级数据库功能。 具有事务(commit)、回滚(rollback)和崩溃修复能力(crash recovery capabilities)的事务安全(transaction-safe (ACID compliant))型表。")])]),e("li",[e("strong",[e("span",[t._v("是否支持外键：")])]),e("span",[t._v(" MyISAM不支持，而InnoDB支持。")])]),e("li",[e("strong",[e("span",[t._v("是否支持MVCC")])]),e("span",[t._v(" ：仅 InnoDB 支持。应对高并发事务, MVCC比单纯的加锁更高效;MVCC只在 ")]),e("code",[t._v("READ COMMITTED")]),e("span",[t._v(" 和 ")]),e("code",[t._v("REPEATABLE READ")]),e("span",[t._v(" 两个隔离级别下工作;MVCC可以使用 乐观(optimistic)锁 和 悲观(pessimistic)锁来实现;各数据库中MVCC实现并不统一。")])])]),e("p",[t._v(" ")]),e("h3",[e("a",{staticClass:"md-header-anchor",attrs:{name:"3查询缓存的使用"}}),e("span",[t._v("3.查询缓存的使用")])]),e("blockquote",[e("p",[e("span",[t._v("执行查询语句的时候，会先查询缓存。不过，MySQL 8.0 版本后移除，因为这个功能不太实用")])])]),e("p",[e("span",[t._v("my.cnf加入以下配置，重启MySQL开启查询缓存")])]),e("pre",{staticClass:"md-fences md-end-block ty-contain-cm modeLoaded",attrs:{spellcheck:"false",lang:""}},[e("div",{staticClass:"CodeMirror cm-s-inner CodeMirror-wrap",attrs:{lang:""}},[e("div",{staticStyle:{overflow:"hidden",position:"relative",width:"3px",height:"0px",top:"0px",left:"8px"}},[e("textarea",{staticStyle:{position:"absolute",bottom:"-1em",padding:"0px",width:"1000px",height:"1em",outline:"none"},attrs:{autocorrect:"off",autocapitalize:"off",spellcheck:"false",tabindex:"0"}})]),e("div",{staticClass:"CodeMirror-scrollbar-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-gutter-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-scroll",attrs:{tabindex:"-1"}},[e("div",{staticClass:"CodeMirror-sizer",staticStyle:{"margin-left":"0px","margin-bottom":"0px","border-right-width":"0px","padding-right":"0px","padding-bottom":"0px"}},[e("div",{staticStyle:{position:"relative",top:"0px"}},[e("div",{staticClass:"CodeMirror-lines",attrs:{role:"presentation"}},[e("div",{staticStyle:{position:"relative",outline:"none"},attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-measure"},[e("pre",[e("span",[t._v("xxxxxxxxxx")])])]),e("div",{staticClass:"CodeMirror-measure"}),e("div",{staticStyle:{position:"relative","z-index":"1"}}),e("div",{staticClass:"CodeMirror-code",attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-activeline",staticStyle:{position:"relative"}},[e("div",{staticClass:"CodeMirror-activeline-background CodeMirror-linebackground"}),e("div",{staticClass:"CodeMirror-gutter-background CodeMirror-activeline-gutter",staticStyle:{left:"0px",width:"0px"}}),e("pre",{staticClass:" CodeMirror-line ",attrs:{role:"presentation"}},[e("span",{staticStyle:{"padding-right":"0.1px"},attrs:{role:"presentation"}},[t._v("query_cache_type=1")])])]),e("pre",{staticClass:" CodeMirror-line ",attrs:{role:"presentation"}},[e("span",{staticStyle:{"padding-right":"0.1px"},attrs:{role:"presentation"}},[t._v("query_cache_size=600000")])])])])])])]),e("div",{staticStyle:{position:"absolute",height:"0px",width:"1px","border-bottom-width":"0px","border-bottom-style":"solid","border-bottom-color":"transparent",top:"34px"}}),e("div",{staticClass:"CodeMirror-gutters",staticStyle:{display:"none",height:"34px"}})])])]),e("p",[e("span",[t._v("MySQL执行以下命令也可以开启查询缓存")])]),e("pre",{staticClass:"md-fences md-end-block ty-contain-cm modeLoaded",attrs:{spellcheck:"false",lang:""}},[e("div",{staticClass:"CodeMirror cm-s-inner CodeMirror-wrap",attrs:{lang:""}},[e("div",{staticStyle:{overflow:"hidden",position:"relative",width:"3px",height:"0px",top:"0px",left:"8px"}},[e("textarea",{staticStyle:{position:"absolute",bottom:"-1em",padding:"0px",width:"1000px",height:"1em",outline:"none"},attrs:{autocorrect:"off",autocapitalize:"off",spellcheck:"false",tabindex:"0"}})]),e("div",{staticClass:"CodeMirror-scrollbar-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-gutter-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-scroll",attrs:{tabindex:"-1"}},[e("div",{staticClass:"CodeMirror-sizer",staticStyle:{"margin-left":"0px","margin-bottom":"0px","border-right-width":"0px","padding-right":"0px","padding-bottom":"0px"}},[e("div",{staticStyle:{position:"relative",top:"0px"}},[e("div",{staticClass:"CodeMirror-lines",attrs:{role:"presentation"}},[e("div",{staticStyle:{position:"relative",outline:"none"},attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-measure"},[e("pre",[e("span",[t._v("xxxxxxxxxx")])])]),e("div",{staticClass:"CodeMirror-measure"}),e("div",{staticStyle:{position:"relative","z-index":"1"}}),e("div",{staticClass:"CodeMirror-code",attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-activeline",staticStyle:{position:"relative"}},[e("div",{staticClass:"CodeMirror-activeline-background CodeMirror-linebackground"}),e("div",{staticClass:"CodeMirror-gutter-background CodeMirror-activeline-gutter",staticStyle:{left:"0px",width:"0px"}}),e("pre",{staticClass:" CodeMirror-line ",attrs:{role:"presentation"}},[e("span",{staticStyle:{"padding-right":"0.1px"},attrs:{role:"presentation"}},[t._v("set global  query_cache_type=1;")])])]),e("pre",{staticClass:" CodeMirror-line ",attrs:{role:"presentation"}},[e("span",{staticStyle:{"padding-right":"0.1px"},attrs:{role:"presentation"}},[t._v("set global  query_cache_size=600000;")])])])])])])]),e("div",{staticStyle:{position:"absolute",height:"0px",width:"1px","border-bottom-width":"0px","border-bottom-style":"solid","border-bottom-color":"transparent",top:"34px"}}),e("div",{staticClass:"CodeMirror-gutters",staticStyle:{display:"none",height:"34px"}})])])]),e("p",[e("strong",[e("span",[t._v("还可以通过sql_cache和sql_no_cache来控制某个查询语句是否需要缓存：")])])]),e("pre",{staticClass:"md-fences md-end-block ty-contain-cm modeLoaded",attrs:{spellcheck:"false",lang:""}},[e("div",{staticClass:"CodeMirror cm-s-inner CodeMirror-wrap",attrs:{lang:""}},[e("div",{staticStyle:{overflow:"hidden",position:"relative",width:"3px",height:"0px",top:"0px",left:"8px"}},[e("textarea",{staticStyle:{position:"absolute",bottom:"-1em",padding:"0px",width:"1000px",height:"1em",outline:"none"},attrs:{autocorrect:"off",autocapitalize:"off",spellcheck:"false",tabindex:"0"}})]),e("div",{staticClass:"CodeMirror-scrollbar-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-gutter-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-scroll",attrs:{tabindex:"-1"}},[e("div",{staticClass:"CodeMirror-sizer",staticStyle:{"margin-left":"0px","margin-bottom":"0px","border-right-width":"0px","padding-right":"0px","padding-bottom":"0px"}},[e("div",{staticStyle:{position:"relative",top:"0px"}},[e("div",{staticClass:"CodeMirror-lines",attrs:{role:"presentation"}},[e("div",{staticStyle:{position:"relative",outline:"none"},attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-measure"},[e("pre",[e("span",[t._v("xxxxxxxxxx")])])]),e("div",{staticClass:"CodeMirror-measure"}),e("div",{staticStyle:{position:"relative","z-index":"1"}}),e("div",{staticClass:"CodeMirror-code",attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-activeline",staticStyle:{position:"relative"}},[e("div",{staticClass:"CodeMirror-activeline-background CodeMirror-linebackground"}),e("div",{staticClass:"CodeMirror-gutter-background CodeMirror-activeline-gutter",staticStyle:{left:"0px",width:"0px"}}),e("pre",{staticClass:" CodeMirror-line ",attrs:{role:"presentation"}},[e("span",{staticStyle:{"padding-right":"0.1px"},attrs:{role:"presentation"}},[t._v("select sql_no_cache count(*) from usr;")])])])])])])])]),e("div",{staticStyle:{position:"absolute",height:"0px",width:"1px","border-bottom-width":"0px","border-bottom-style":"solid","border-bottom-color":"transparent",top:"17px"}}),e("div",{staticClass:"CodeMirror-gutters",staticStyle:{display:"none",height:"17px"}})])])]),e("p",[t._v(" ")]),e("h3",[e("a",{staticClass:"md-header-anchor",attrs:{name:"4事务隔离级别有哪些mysql的默认隔离级别是"}}),e("span",[t._v("4.事务隔离级别有哪些?MySQL的默认隔离级别是?")])]),e("p",[e("strong",[e("span",[t._v("SQL 标准定义了四个隔离级别：")])])]),e("ul",[e("li",[e("p",[e("strong",[e("span",[t._v("READ-UNCOMMITTED(读取未提交)：")])]),e("span",[t._v(" 最低的隔离级别，允许读取尚未提交的数据变更，")]),e("strong",[e("span",[t._v("可能会导致脏读、幻读或不可重复读")])]),e("span",[t._v("。")])])]),e("li",[e("p",[e("strong",[e("span",[t._v("READ-COMMITTED(读取已提交)：")])]),e("span",[t._v(" 允许读取并发事务已经提交的数据，")]),e("strong",[e("span",[t._v("可以阻止脏读，但是幻读或不可重复读仍有可能发生")])]),e("span",[t._v("。")])])]),e("li",[e("p",[e("strong",[e("span",[t._v("REPEATABLE-READ(可重复读)：")])]),e("span",[t._v(" 对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改，")]),e("strong",[e("span",[t._v("可以阻止脏读和不可重复读，但幻读仍有可能发生")])]),e("span",[t._v("。")])])]),e("li",[e("p",[e("strong",[e("span",[t._v("SERIALIZABLE(可串行化)：")])]),e("span",[t._v(" 最高的隔离级别，完全服从ACID的隔离级别。所有的事务依次逐个执行，这样事务之间就完全不可能产生干扰，也就是说，")]),e("strong",[e("span",[t._v("该级别可以防止脏读、不可重复读以及幻读")])]),e("span",[t._v("。")])]),e("p",[t._v(" ")])])]),e("figure",[e("table",[e("thead",[e("tr",[e("th",[e("span",[t._v("隔离级别")])]),e("th",[e("span",[t._v("脏读")])]),e("th",[e("span",[t._v("不可重复读")])]),e("th",[e("span",[t._v("幻影读")])])])]),e("tbody",[e("tr",[e("td",[e("span",[t._v("READ-UNCOMMITTED")])]),e("td",[e("span",[t._v("√")])]),e("td",[e("span",[t._v("√")])]),e("td",[e("span",[t._v("√")])])]),e("tr",[e("td",[e("span",[t._v("READ-COMMITTED")])]),e("td",[e("span",[t._v("×")])]),e("td",[e("span",[t._v("√")])]),e("td",[e("span",[t._v("√")])])]),e("tr",[e("td",[e("span",[t._v("REPEATABLE-READ")])]),e("td",[e("span",[t._v("×")])]),e("td",[e("span",[t._v("×")])]),e("td",[e("span",[t._v("√")])])]),e("tr",[e("td",[e("span",[t._v("SERIALIZABLE")])]),e("td",[e("span",[t._v("×")])]),e("td",[e("span",[t._v("×")])]),e("td",[e("span",[t._v("×")])])])])])]),e("p",[t._v(" ")]),e("p",[e("strong",[e("span",[t._v("查看默认隔离级别")])])]),e("pre",{staticClass:"md-fences md-end-block ty-contain-cm modeLoaded",attrs:{spellcheck:"false",lang:""}},[e("div",{staticClass:"CodeMirror cm-s-inner CodeMirror-wrap",attrs:{lang:""}},[e("div",{staticStyle:{overflow:"hidden",position:"relative",width:"3px",height:"0px",top:"0px",left:"8px"}},[e("textarea",{staticStyle:{position:"absolute",bottom:"-1em",padding:"0px",width:"1000px",height:"1em",outline:"none"},attrs:{autocorrect:"off",autocapitalize:"off",spellcheck:"false",tabindex:"0"}})]),e("div",{staticClass:"CodeMirror-scrollbar-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-gutter-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-scroll",attrs:{tabindex:"-1"}},[e("div",{staticClass:"CodeMirror-sizer",staticStyle:{"margin-left":"0px","margin-bottom":"0px","border-right-width":"0px","padding-right":"0px","padding-bottom":"0px"}},[e("div",{staticStyle:{position:"relative",top:"0px"}},[e("div",{staticClass:"CodeMirror-lines",attrs:{role:"presentation"}},[e("div",{staticStyle:{position:"relative",outline:"none"},attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-measure"},[e("pre",[e("span",[t._v("xxxxxxxxxx")])])]),e("div",{staticClass:"CodeMirror-measure"}),e("div",{staticStyle:{position:"relative","z-index":"1"}}),e("div",{staticClass:"CodeMirror-code",attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-activeline",staticStyle:{position:"relative"}},[e("div",{staticClass:"CodeMirror-activeline-background CodeMirror-linebackground"}),e("div",{staticClass:"CodeMirror-gutter-background CodeMirror-activeline-gutter",staticStyle:{left:"0px",width:"0px"}}),e("pre",{staticClass:" CodeMirror-line ",attrs:{role:"presentation"}},[e("span",{staticStyle:{"padding-right":"0.1px"},attrs:{role:"presentation"}},[t._v("mysql> SELECT @@tx_isolation;")])])]),e("pre",{staticClass:" CodeMirror-line ",attrs:{role:"presentation"}},[e("span",{staticStyle:{"padding-right":"0.1px"},attrs:{role:"presentation"}},[t._v("+-----------------+")])]),e("pre",{staticClass:" CodeMirror-line ",attrs:{role:"presentation"}},[e("span",{staticStyle:{"padding-right":"0.1px"},attrs:{role:"presentation"}},[t._v("| @@tx_isolation  |")])]),e("pre",{staticClass:" CodeMirror-line ",attrs:{role:"presentation"}},[e("span",{staticStyle:{"padding-right":"0.1px"},attrs:{role:"presentation"}},[t._v("+-----------------+")])]),e("pre",{staticClass:" CodeMirror-line ",attrs:{role:"presentation"}},[e("span",{staticStyle:{"padding-right":"0.1px"},attrs:{role:"presentation"}},[t._v("| REPEATABLE-READ |")])]),e("pre",{staticClass:" CodeMirror-line ",attrs:{role:"presentation"}},[e("span",{staticStyle:{"padding-right":"0.1px"},attrs:{role:"presentation"}},[t._v("+-----------------+")])])])])])])]),e("div",{staticStyle:{position:"absolute",height:"0px",width:"1px","border-bottom-width":"0px","border-bottom-style":"solid","border-bottom-color":"transparent",top:"102px"}}),e("div",{staticClass:"CodeMirror-gutters",staticStyle:{display:"none",height:"102px"}})])])]),e("p",[e("strong",[e("span",[t._v("表级锁和行级锁对比：")])])]),e("ul",[e("li",[e("p",[e("strong",[e("span",[t._v("表级锁：")])]),e("span",[t._v(" MySQL中锁定 ")]),e("strong",[e("span",[t._v("粒度最大")])]),e("span",[t._v(" 的一种锁，对当前操作的整张表加锁，实现简单，资源消耗也比较少，加锁快，不会出现死锁。其锁定粒度最大，触发锁冲突的概率最高，并发度最低，MyISAM和 InnoDB引擎都支持表级锁。")])])]),e("li",[e("p",[e("strong",[e("span",[t._v("行级锁：")])]),e("span",[t._v(" MySQL中锁定 ")]),e("strong",[e("span",[t._v("粒度最小")])]),e("span",[t._v(" 的一种锁，只针对当前操作的行进行加锁。 行级锁能大大减少数据库操作的冲突。其加锁粒度最小，并发度高，但加锁的开销也最大，加锁慢，会出现死锁。")]),e("strong",[e("span",[t._v("InnoDB的行锁基于索引，")])]),e("span",[t._v("只有通过")]),e("strong",[e("span",[t._v("索引条件")])]),e("span",[t._v("检索数据")]),e("strong",[e("span",[t._v("才使用行级锁")])]),e("span",[t._v("，否则，InnoDB将使用")]),e("strong",[e("span",[t._v("表锁。 ")])])]),e("p",[t._v(" ")])])]),e("figure",[e("table",[e("thead",[e("tr",[e("th",[e("span",[t._v("类别")])]),e("th",[e("span",[t._v("加锁区域")])]),e("th",[e("span",[t._v("资源消耗")])]),e("th",[e("span",[t._v("速度")])]),e("th",[e("span",[t._v("死锁")])]),e("th",[e("span",[t._v("粒度")])]),e("th",[e("span",[t._v("锁冲突概率")])]),e("th",[e("span",[t._v("并发度")])]),e("th",[e("span",[t._v("引擎支持")])])])]),e("tbody",[e("tr",[e("td",[e("span",[t._v("表级锁")])]),e("td",[e("span",[t._v("整表")])]),e("td",[e("span",[t._v("少")])]),e("td",[e("span",[t._v("快")])]),e("td",[e("span",[t._v("不会")])]),e("td",[e("span",[t._v("大")])]),e("td",[e("span",[t._v("高")])]),e("td",[e("span",[t._v("低")])]),e("td",[e("span",[t._v("MyISAM/InnoDB")])])]),e("tr",[e("td",[e("span",[t._v("行级锁")])]),e("td",[e("span",[t._v("单行")])]),e("td",[e("span",[t._v("多")])]),e("td",[e("span",[t._v("慢")])]),e("td",[e("span",[t._v("会")])]),e("td",[e("span",[t._v("小")])]),e("td",[e("span",[t._v("小")])]),e("td",[e("span",[t._v("高")])]),e("td",[e("span",[t._v("InnoDB")])])])])])]),e("p",[t._v(" ")]),e("p",[t._v(" ")]),e("h3",[e("a",{staticClass:"md-header-anchor",attrs:{name:"5大表优化"}}),e("span",[t._v("5.大表优化")])]),e("p",[e("span",[t._v("当MySQL单表记录数过大时，数据库的CRUD性能会明显下降，一些常见的优化措施如下：")])]),e("h4",[e("a",{staticClass:"md-header-anchor",attrs:{name:"1-限定数据的范围"}}),e("span",[t._v("1. 限定数据的范围")])]),e("p",[e("span",[t._v("务必禁止不带任何限制数据范围条件的查询语句。比如：我们当用户在查询订单历史的时候，我们可以控制在一个月的范围内；")])]),e("h4",[e("a",{staticClass:"md-header-anchor",attrs:{name:"2-读写分离"}}),e("span",[t._v("2. 读/写分离")])]),e("p",[e("span",[t._v("经典的数据库拆分方案，主库负责写，从库负责读；")])]),e("h4",[e("a",{staticClass:"md-header-anchor",attrs:{name:"3-垂直分区"}}),e("span",[t._v("3. 垂直分区")])]),e("p",[e("span",[t._v("简单来说垂直拆分是指数据表列的拆分，把一张列比较多的表拆分为多张表。即满足数据库第三范式。")])]),e("h4",[e("a",{staticClass:"md-header-anchor",attrs:{name:"4-水平分区"}}),e("span",[t._v("4. 水平分区")])]),e("p",[e("span",[t._v("保持数据表结构不变，通过某种策略存储数据分片。这样每一片数据分散到不同的表或者库中，达到了分布式的目的。 水平拆分可以支撑非常大的数据量。水平拆分能够 ")]),e("strong",[e("span",[t._v("支持非常大的数据量存储，应用端改造也少")])]),e("span",[t._v("，但 ")]),e("strong",[e("span",[t._v("分片事务难以解决")])]),e("span",[t._v(" ，跨节点Join性能较差，逻辑复杂，")]),e("strong",[e("span",[t._v("拆分会带来逻辑、部署、运维的各种复杂度")])]),e("span",[t._v(" 。")])]),e("h4",[e("a",{staticClass:"md-header-anchor",attrs:{name:"5-表分区-partition"}}),e("span",[t._v("5. 表分区 PARTITION")])]),e("p",[e("span",[t._v("对表进行最大1024个分区")])]),e("h4",[e("a",{staticClass:"md-header-anchor",attrs:{name:"6主键类型"}}),e("span",[t._v("6.主键类型")])]),e("p",[e("span",[t._v("MySQL推荐主键使用尽量短的非字符类型")])]),e("ul",[e("li",[e("p",[e("span",[t._v("UUID")])]),e("ul",[e("li",[e("span",[t._v("+性能非常高：本地生成，没有网络消耗。")])])])]),e("li",[e("p",[e("span",[t._v("-不易于存储：UUID太长，16字节128位，通常以36长度的字符串表示，很多场景不适用。")])]),e("ul",[e("li",[e("span",[t._v("-信息不安全：基于MAC地址生成UUID的算法可能会造成MAC地址泄露，这个漏洞曾被用于寻找梅丽莎病毒的制作者位置。")])])])]),e("li",[e("p",[e("span",[t._v("-对MySQL索引不利：如果作为数据库主键，在InnoDB引擎下，UUID的无序性可能会引起数据位置频繁变动，严重影响性能。")])])]),e("li",[e("p",[e("a",{attrs:{href:"https://tech.meituan.com/2017/04/21/mt-leaf.html"}},[e("span",[t._v("Leaf分布式ID生成系统，是美团开源的分布式ID生成器")])])]),e("ul",[e("li",[e("span",[t._v("+全局唯一性、趋势递增、单调递增、信息安全")])]),e("li",[e("span",[t._v("-需要依赖关系数据库、Zookeeper等中间件")])])])])]),e("p",[t._v(" ")]),e("figure",[e("table",[e("thead",[e("tr",[e("th",[e("span",[t._v("优化方案 ")]),e("a",{attrs:{href:"https://segmentfault.com/a/1190000006158186"}},[e("span",[t._v("摘录自'manong'")])])])])]),e("tbody",[e("tr",[e("td",[e("span",[t._v("尽量使用")]),e("code",[t._v("TINYINT")]),e("span",[t._v("、")]),e("code",[t._v("SMALLINT")]),e("span",[t._v("、")]),e("code",[t._v("MEDIUM_INT")]),e("span",[t._v("作为整数类型而非")]),e("code",[t._v("INT")])])]),e("tr",[e("td",[e("code",[t._v("VARCHAR")]),e("span",[t._v("的长度只分配真正需要的空间")])])]),e("tr",[e("td",[e("span",[t._v("避免使用NULL字段，很难查询优化且占用额外索引空间")])])]),e("tr",[e("td",[e("span",[t._v("根据")]),e("code",[t._v("EXPLAIN")]),e("span",[t._v("来查看是否用了索引还是全表扫描")])])]),e("tr",[e("td",[e("span",[t._v("避免在")]),e("code",[t._v("WHERE")]),e("span",[t._v("子句中对字段进行")]),e("code",[t._v("NULL")]),e("span",[t._v("值判断，否则将导致引擎放弃使用索引而进行全表扫描")])])]),e("tr",[e("td",[e("span",[t._v("不用外键，不用")]),e("code",[t._v("UNIQUE")]),e("span",[t._v("，由程序保证约束")])])]),e("tr",[e("td",[e("span",[t._v("字符字段最好不要做主键")])])]),e("tr",[e("td",[e("span",[t._v("使用多列索引时主意顺序和查询条件保持一致，同时删除不必要的单列索引")])])]),e("tr",[e("td",[e("span",[t._v("不做列运算，任何对列的操作都将导致表扫描，它包括数据库教程函数、计算表达式等等，查询时要尽可能将操作移至等号右边")])])]),e("tr",[e("td",[e("span",[t._v("大语句拆小语句，减少锁时间")])])]),e("tr",[e("td",[e("code",[t._v("OR")]),e("span",[t._v("改写成")]),e("code",[t._v("IN")]),e("span",[t._v("：")]),e("code",[t._v("OR")]),e("span",[t._v("的效率是n级别，")]),e("code",[t._v("IN")]),e("span",[t._v("的效率是log(n)级别，in的个数建议控制在200以内")])])]),e("tr",[e("td",[e("span",[t._v("使用同类型进行比较，比如用")]),e("code",[t._v("'123'")]),e("span",[t._v("和")]),e("code",[t._v("'123'")]),e("span",[t._v("比，")]),e("code",[t._v("123")]),e("span",[t._v("和")]),e("code",[t._v("123")]),e("span",[t._v("比")])])]),e("tr",[e("td",[e("span",[t._v("对于连续数值，使用")]),e("code",[t._v("BETWEEN")]),e("span",[t._v("不用")]),e("code",[t._v("IN")])])])])])]),e("p",[t._v(" ")]),e("p",[t._v(" ")]),e("h3",[e("a",{staticClass:"md-header-anchor",attrs:{name:"6锁"}}),e("span",[t._v("6.锁")])]),e("p",[e("a",{attrs:{href:"https://juejin.im/post/5b55b842f265da0f9e589e79"}},[e("span",[t._v("摘录自Java3y")])])]),e("p",[t._v(" ")]),e("p",[e("strong",[e("span",[t._v("1.InnoDB行锁")])])]),e("ul",[e("li",[e("span",[t._v("共享锁(S锁) : 允许一个事务去读一行，阻止其他事务获得相同数据集的排他锁。也叫做")]),e("strong",[e("span",[t._v("读锁")])]),e("span",[t._v("：读锁是")]),e("strong",[e("span",[t._v("共享")])]),e("span",[t._v("的，多个客户可以")]),e("strong",[e("span",[t._v("同时读取同一个")])]),e("span",[t._v("资源，但")]),e("strong",[e("span",[t._v("不允许其他客户修改")])]),e("span",[t._v("。")]),e("code",[t._v("SELECT * FROM table_name WHERE ... LOCK IN SHARE MODE")])]),e("li",[e("span",[t._v("排他锁(X锁) : 允许获得排他锁的事务更新数据，阻止其他事务取得相同数据集的共享读锁和排他写锁。也叫做")]),e("strong",[e("span",[t._v("写锁")])]),e("span",[t._v("：写锁是排他的，")]),e("strong",[e("span",[t._v("写锁会阻塞其他的写锁和读锁")])]),e("span",[t._v("。")]),e("code",[t._v("SELECT * FROM table_name WHERE ... FOR UPDATE")])])]),e("p",[e("strong",[e("span",[t._v("2.乐观锁和悲观锁")])])]),e("ul",[e("li",[e("span",[t._v("乐观锁是一种思想，具体实现是，表中有一个版本字段，第一次读的时候，获取到这个字段。处理完业务逻辑开始更新的时候，需要再次查看该字段的值是否和第一次的一样。如果一样更新，反之拒绝。之所以叫乐观，因为这个模式没有从数据库加锁，等到更新的时候再判断是否可以更新。")])]),e("li",[e("span",[t._v("悲观锁是数据库层面加锁，都会阻塞去等待锁。")])])]),e("p",[e("strong",[e("span",[t._v("3.间隙锁")])])]),e("ul",[e("li",[e("span",[t._v("当我们")]),e("strong",[e("span",[t._v("用范围条件检索数据")])]),e("span",[t._v("而不是相等条件检索数据，并请求共享或排他锁时，InnoDB会给")]),e("strong",[e("span",[t._v("符合范围条件的已有数据记录的索引项加锁")])]),e("span",[t._v("；对于键值在条件范围内但并不存在的记录，叫做“间隙（GAP)”。InnoDB也会对这个“间隙”加锁，这种锁机制就是所谓的间隙锁。")])]),e("li",[e("span",[t._v("只会在")]),e("code",[t._v("Repeatable read")]),e("span",[t._v("隔离级别下使用。")])]),e("li",[e("strong",[e("span",[t._v("为了防止幻读")])]),e("span",[t._v(" (")]),e("code",[t._v("Repeatable read")]),e("span",[t._v("隔离级别下再通过GAP锁可避免幻读)")])])]),e("p",[e("strong",[e("span",[t._v("4.死锁")])])]),e("p",[e("code",[t._v("死锁是指两个或两个以上的进程在执行过程中，由于竞争资源或者由于彼此通信而造成的一种阻塞的现象，若无外力作用，它们都将无法推进下去。此时称系统处于死锁状态或系统产生了死锁，这些永远在互相等待的进程称为死锁进程。")])]),e("p",[e("span",[t._v("如何避免死锁")])]),e("ul",[e("li",[e("p",[e("span",[t._v("以")]),e("strong",[e("span",[t._v("固定的顺序")])]),e("span",[t._v("访问表和行。比如对两个job批量更新的情形，简单方法是对id列表先排序，后执行，这样就避免了交叉等待锁的情形；将两个事务的sql顺序调整为一致，也能避免死锁。")])])]),e("li",[e("p",[e("strong",[e("span",[t._v("大事务拆小")])]),e("span",[t._v("。大事务更倾向于死锁，如果业务允许，将大事务拆小。")])])]),e("li",[e("p",[e("span",[t._v("在同一个事务中，尽可能做到")]),e("strong",[e("span",[t._v("一次锁定")])]),e("span",[t._v("所需要的所有资源，减少死锁概率。")])])]),e("li",[e("p",[e("strong",[e("span",[t._v("降低隔离级别")])]),e("span",[t._v("。如果业务允许，将隔离级别调低也是较好的选择，比如将隔离级别从RR调整为RC，可以避免掉很多因为gap锁造成的死锁。")])])]),e("li",[e("p",[e("strong",[e("span",[t._v("为表添加合理的索引")])]),e("span",[t._v("。可以看到如果不走索引将会为表的每一行记录添加上锁，死锁的概率大大增大。")])]),e("p",[t._v(" ")])])]),e("p",[t._v(" ")]),e("h3",[e("a",{staticClass:"md-header-anchor",attrs:{name:"7索引"}}),e("span",[t._v("7.索引")])]),e("p",[e("span",[t._v("将无需的数据变成相对有序的数据, 加速检索速度, 但是索引会占用物理空间. 需要避免没有必要的索引.")])]),e("p",[e("strong",[e("span",[t._v("哪里需要索引?")])])]),e("ul",[e("li",[e("span",[t._v("频繁搜索的列")])]),e("li",[e("span",[t._v("WHERE条件的列")])]),e("li",[e("span",[t._v("需要排序的列")])]),e("li",[e("span",[t._v("外连接的列")])])]),e("p",[e("strong",[e("span",[t._v("什么情况会导致索引失效")])])]),e("ul",[e("li",[e("span",[t._v("WHERE中对列施加函数")])]),e("li",[e("span",[t._v("索引列不是NOT NULL")])])]),e("p",[e("del",[e("strong",[e("span",[t._v("聚簇索引")])])])]),e("p",[e("strong",[e("span",[t._v("覆盖索引")])])]),e("ul",[e("li",[e("span",[t._v("索引中包含了所有要查询的列")])])]),e("p",[e("strong",[e("span",[t._v("Mysql如何为表字段添加索引")])])]),e("p",[e("span",[t._v("1.添加PRIMARY KEY（主键索引）")])]),e("pre",{staticClass:"md-fences md-end-block ty-contain-cm modeLoaded",attrs:{spellcheck:"false",lang:""}},[e("div",{staticClass:"CodeMirror cm-s-inner CodeMirror-wrap",attrs:{lang:""}},[e("div",{staticStyle:{overflow:"hidden",position:"relative",width:"3px",height:"0px",top:"0px",left:"8px"}},[e("textarea",{staticStyle:{position:"absolute",bottom:"-1em",padding:"0px",width:"1000px",height:"1em",outline:"none"},attrs:{autocorrect:"off",autocapitalize:"off",spellcheck:"false",tabindex:"0"}})]),e("div",{staticClass:"CodeMirror-scrollbar-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-gutter-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-scroll",attrs:{tabindex:"-1"}},[e("div",{staticClass:"CodeMirror-sizer",staticStyle:{"margin-left":"0px","margin-bottom":"0px","border-right-width":"0px","padding-right":"0px","padding-bottom":"0px"}},[e("div",{staticStyle:{position:"relative",top:"0px"}},[e("div",{staticClass:"CodeMirror-lines",attrs:{role:"presentation"}},[e("div",{staticStyle:{position:"relative",outline:"none"},attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-measure"},[e("pre",[e("span",[t._v("xxxxxxxxxx")])])]),e("div",{staticClass:"CodeMirror-measure"}),e("div",{staticStyle:{position:"relative","z-index":"1"}}),e("div",{staticClass:"CodeMirror-code",attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-activeline",staticStyle:{position:"relative"}},[e("div",{staticClass:"CodeMirror-activeline-background CodeMirror-linebackground"}),e("div",{staticClass:"CodeMirror-gutter-background CodeMirror-activeline-gutter",staticStyle:{left:"0px",width:"0px"}}),e("pre",{staticClass:" CodeMirror-line ",attrs:{role:"presentation"}},[e("span",{staticStyle:{"padding-right":"0.1px"},attrs:{role:"presentation"}},[t._v("ALTER TABLE `table_name` ADD PRIMARY KEY ( `column` ) ")])])])])])])])]),e("div",{staticStyle:{position:"absolute",height:"0px",width:"1px","border-bottom-width":"0px","border-bottom-style":"solid","border-bottom-color":"transparent",top:"17px"}}),e("div",{staticClass:"CodeMirror-gutters",staticStyle:{display:"none",height:"17px"}})])])]),e("p",[e("span",[t._v("2.添加UNIQUE(唯一索引)")])]),e("pre",{staticClass:"md-fences md-end-block ty-contain-cm modeLoaded",attrs:{spellcheck:"false",lang:""}},[e("div",{staticClass:"CodeMirror cm-s-inner CodeMirror-wrap",attrs:{lang:""}},[e("div",{staticStyle:{overflow:"hidden",position:"relative",width:"3px",height:"0px",top:"0px",left:"8px"}},[e("textarea",{staticStyle:{position:"absolute",bottom:"-1em",padding:"0px",width:"1000px",height:"1em",outline:"none"},attrs:{autocorrect:"off",autocapitalize:"off",spellcheck:"false",tabindex:"0"}})]),e("div",{staticClass:"CodeMirror-scrollbar-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-gutter-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-scroll",attrs:{tabindex:"-1"}},[e("div",{staticClass:"CodeMirror-sizer",staticStyle:{"margin-left":"0px","margin-bottom":"0px","border-right-width":"0px","padding-right":"0px","padding-bottom":"0px"}},[e("div",{staticStyle:{position:"relative",top:"0px"}},[e("div",{staticClass:"CodeMirror-lines",attrs:{role:"presentation"}},[e("div",{staticStyle:{position:"relative",outline:"none"},attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-measure"},[e("pre",[e("span",[t._v("xxxxxxxxxx")])])]),e("div",{staticClass:"CodeMirror-measure"}),e("div",{staticStyle:{position:"relative","z-index":"1"}}),e("div",{staticClass:"CodeMirror-code",attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-activeline",staticStyle:{position:"relative"}},[e("div",{staticClass:"CodeMirror-activeline-background CodeMirror-linebackground"}),e("div",{staticClass:"CodeMirror-gutter-background CodeMirror-activeline-gutter",staticStyle:{left:"0px",width:"0px"}}),e("pre",{staticClass:" CodeMirror-line ",attrs:{role:"presentation"}},[e("span",{staticStyle:{"padding-right":"0.1px"},attrs:{role:"presentation"}},[t._v("ALTER TABLE `table_name` ADD UNIQUE ( `column` ) ")])])])])])])])]),e("div",{staticStyle:{position:"absolute",height:"0px",width:"1px","border-bottom-width":"0px","border-bottom-style":"solid","border-bottom-color":"transparent",top:"17px"}}),e("div",{staticClass:"CodeMirror-gutters",staticStyle:{display:"none",height:"17px"}})])])]),e("p",[e("span",[t._v("3.添加INDEX(普通索引)")])]),e("pre",{staticClass:"md-fences md-end-block ty-contain-cm modeLoaded",attrs:{spellcheck:"false",lang:""}},[e("div",{staticClass:"CodeMirror cm-s-inner CodeMirror-wrap",attrs:{lang:""}},[e("div",{staticStyle:{overflow:"hidden",position:"relative",width:"3px",height:"0px",top:"0px",left:"8px"}},[e("textarea",{staticStyle:{position:"absolute",bottom:"-1em",padding:"0px",width:"1000px",height:"1em",outline:"none"},attrs:{autocorrect:"off",autocapitalize:"off",spellcheck:"false",tabindex:"0"}})]),e("div",{staticClass:"CodeMirror-scrollbar-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-gutter-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-scroll",attrs:{tabindex:"-1"}},[e("div",{staticClass:"CodeMirror-sizer",staticStyle:{"margin-left":"0px","margin-bottom":"0px","border-right-width":"0px","padding-right":"0px","padding-bottom":"0px"}},[e("div",{staticStyle:{position:"relative",top:"0px"}},[e("div",{staticClass:"CodeMirror-lines",attrs:{role:"presentation"}},[e("div",{staticStyle:{position:"relative",outline:"none"},attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-measure"},[e("pre",[e("span",[t._v("xxxxxxxxxx")])])]),e("div",{staticClass:"CodeMirror-measure"}),e("div",{staticStyle:{position:"relative","z-index":"1"}}),e("div",{staticClass:"CodeMirror-code",attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-activeline",staticStyle:{position:"relative"}},[e("div",{staticClass:"CodeMirror-activeline-background CodeMirror-linebackground"}),e("div",{staticClass:"CodeMirror-gutter-background CodeMirror-activeline-gutter",staticStyle:{left:"0px",width:"0px"}}),e("pre",{staticClass:" CodeMirror-line ",attrs:{role:"presentation"}},[e("span",{staticStyle:{"padding-right":"0.1px"},attrs:{role:"presentation"}},[t._v("ALTER TABLE `table_name` ADD INDEX index_name ( `column` )")])])])])])])])]),e("div",{staticStyle:{position:"absolute",height:"0px",width:"1px","border-bottom-width":"0px","border-bottom-style":"solid","border-bottom-color":"transparent",top:"17px"}}),e("div",{staticClass:"CodeMirror-gutters",staticStyle:{display:"none",height:"17px"}})])])]),e("p",[e("span",[t._v("4.添加FULLTEXT(全文索引)")])]),e("pre",{staticClass:"md-fences md-end-block ty-contain-cm modeLoaded",attrs:{spellcheck:"false",lang:""}},[e("div",{staticClass:"CodeMirror cm-s-inner CodeMirror-wrap",attrs:{lang:""}},[e("div",{staticStyle:{overflow:"hidden",position:"relative",width:"3px",height:"0px",top:"0px",left:"8px"}},[e("textarea",{staticStyle:{position:"absolute",bottom:"-1em",padding:"0px",width:"1000px",height:"1em",outline:"none"},attrs:{autocorrect:"off",autocapitalize:"off",spellcheck:"false",tabindex:"0"}})]),e("div",{staticClass:"CodeMirror-scrollbar-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-gutter-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-scroll",attrs:{tabindex:"-1"}},[e("div",{staticClass:"CodeMirror-sizer",staticStyle:{"margin-left":"0px","margin-bottom":"0px","border-right-width":"0px","padding-right":"0px","padding-bottom":"0px"}},[e("div",{staticStyle:{position:"relative",top:"0px"}},[e("div",{staticClass:"CodeMirror-lines",attrs:{role:"presentation"}},[e("div",{staticStyle:{position:"relative",outline:"none"},attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-measure"},[e("pre",[e("span",[t._v("xxxxxxxxxx")])])]),e("div",{staticClass:"CodeMirror-measure"}),e("div",{staticStyle:{position:"relative","z-index":"1"}}),e("div",{staticClass:"CodeMirror-code",attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-activeline",staticStyle:{position:"relative"}},[e("div",{staticClass:"CodeMirror-activeline-background CodeMirror-linebackground"}),e("div",{staticClass:"CodeMirror-gutter-background CodeMirror-activeline-gutter",staticStyle:{left:"0px",width:"0px"}}),e("pre",{staticClass:" CodeMirror-line ",attrs:{role:"presentation"}},[e("span",{staticStyle:{"padding-right":"0.1px"},attrs:{role:"presentation"}},[t._v("ALTER TABLE `table_name` ADD FULLTEXT ( `column`) ")])])])])])])])]),e("div",{staticStyle:{position:"absolute",height:"0px",width:"1px","border-bottom-width":"0px","border-bottom-style":"solid","border-bottom-color":"transparent",top:"17px"}}),e("div",{staticClass:"CodeMirror-gutters",staticStyle:{display:"none",height:"17px"}})])])]),e("p",[e("span",[t._v("5.添加多列索引")])]),e("pre",{staticClass:"md-fences md-end-block ty-contain-cm modeLoaded",attrs:{spellcheck:"false",lang:""}},[e("div",{staticClass:"CodeMirror cm-s-inner CodeMirror-wrap",attrs:{lang:""}},[e("div",{staticStyle:{overflow:"hidden",position:"relative",width:"3px",height:"0px",top:"0px",left:"8px"}},[e("textarea",{staticStyle:{position:"absolute",bottom:"-1em",padding:"0px",width:"1000px",height:"1em",outline:"none"},attrs:{autocorrect:"off",autocapitalize:"off",spellcheck:"false",tabindex:"0"}})]),e("div",{staticClass:"CodeMirror-scrollbar-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-gutter-filler",attrs:{"cm-not-content":"true"}}),e("div",{staticClass:"CodeMirror-scroll",attrs:{tabindex:"-1"}},[e("div",{staticClass:"CodeMirror-sizer",staticStyle:{"margin-left":"0px","margin-bottom":"0px","border-right-width":"0px","padding-right":"0px","padding-bottom":"0px"}},[e("div",{staticStyle:{position:"relative",top:"0px"}},[e("div",{staticClass:"CodeMirror-lines",attrs:{role:"presentation"}},[e("div",{staticStyle:{position:"relative",outline:"none"},attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-measure"},[e("pre",[e("span",[t._v("xxxxxxxxxx")])])]),e("div",{staticClass:"CodeMirror-measure"}),e("div",{staticStyle:{position:"relative","z-index":"1"}}),e("div",{staticClass:"CodeMirror-code",attrs:{role:"presentation"}},[e("div",{staticClass:"CodeMirror-activeline",staticStyle:{position:"relative"}},[e("div",{staticClass:"CodeMirror-activeline-background CodeMirror-linebackground"}),e("div",{staticClass:"CodeMirror-gutter-background CodeMirror-activeline-gutter",staticStyle:{left:"0px",width:"0px"}}),e("pre",{staticClass:" CodeMirror-line ",attrs:{role:"presentation"}},[e("span",{staticStyle:{"padding-right":"0.1px"},attrs:{role:"presentation"}},[t._v("ALTER TABLE `table_name` ADD INDEX index_name ( `column1`, `column2`, `column3` )")])])])])])])])]),e("div",{staticStyle:{position:"absolute",height:"0px",width:"1px","border-bottom-width":"0px","border-bottom-style":"solid","border-bottom-color":"transparent",top:"17px"}}),e("div",{staticClass:"CodeMirror-gutters",staticStyle:{display:"none",height:"17px"}})])])]),e("p",[t._v(" ")]),e("p",[t._v(" ")]),e("p",[t._v(" ")])])])}],r=(e("482a"),e("2877")),o={},n=Object(r["a"])(o,s,i,!1,null,"6a51d7a4",null);a["default"]=n.exports},e8cd:function(t,a,e){}}]);